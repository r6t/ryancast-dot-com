--- templates/cloudfront-site.yaml	2026-01-30 09:19:03
+++ /tmp/templates-orig/cloudfront-site.yaml	2026-02-02 10:00:11
@@ -52,6 +52,28 @@
               StringEquals:
                 'AWS:SourceArn': !Sub 'arn:aws:cloudfront::${AWS::AccountId}:distribution/${CloudFrontDistribution}'
 
+  CloudFrontFunction:
+    Type: AWS::CloudFront::Function
+    Properties:
+      Name: !Sub "${AWS::StackName}-URLRewriter"
+      FunctionConfig:
+        Comment: "Rewrite URLs to append /index.html"
+        Runtime: "cloudfront-js-1.0"
+      AutoPublish: true
+      FunctionCode: |
+        function handler(event) {
+          var request = event.request;
+          var uri = request.uri;
+
+          // Check if the URI matches any directory path
+          if (uri.match(/^\/[^.]+\/?$/)) {
+            // Remove trailing slash if present, then append index.html
+            request.uri = uri.replace(/\/$/, '') + '/index.html';
+          }
+
+          return request;
+        }
+
   CloudFrontDistribution:
     Type: AWS::CloudFront::Distribution
     Properties:
@@ -68,6 +90,9 @@
           TargetOriginId: !Sub 'S3-${AWS::StackName}-root'
           ViewerProtocolPolicy: 'redirect-to-https'
           ResponseHeadersPolicyId: !Ref ResponseHeadersPolicy
+          FunctionAssociations:
+            - EventType: viewer-request
+              FunctionARN: !GetAtt CloudFrontFunction.FunctionARN
         CustomErrorResponses:
           - ErrorCachingMinTTL: 60
             ErrorCode: 404
@@ -93,7 +118,7 @@
         PriceClass: 'PriceClass_All'
         ViewerCertificate:
           AcmCertificateArn: !Ref 'CertificateArn'
-          MinimumProtocolVersion: 'TLSv1.1_2016'
+          MinimumProtocolVersion: 'TLSv1.2_2021'
           SslSupportMethod: 'sni-only'
       Tags:
         - Key: Solution
@@ -151,7 +176,7 @@
             Override: true
             Preload: true
           ContentSecurityPolicy:
-            ContentSecurityPolicy: "default-src 'none'; img-src 'self'; script-src 'self'; style-src 'self'; object-src 'none'"
+            ContentSecurityPolicy: "default-src 'self'; script-src 'self' https://giscus.app; style-src 'self' 'unsafe-inline' https://giscus.app; frame-src 'self' https://giscus.app; connect-src 'self' https://giscus.app"
             Override: true
           ContentTypeOptions:
             Override: true
--- templates/custom-resource.yaml	2026-01-30 09:19:03
+++ /tmp/templates-orig/custom-resource.yaml	2026-02-02 10:00:28
@@ -19,6 +19,11 @@
         ServerSideEncryptionConfiguration:
           - ServerSideEncryptionByDefault:
               SSEAlgorithm: AES256
+      PublicAccessBlockConfiguration:
+        BlockPublicAcls: true
+        BlockPublicPolicy: true
+        IgnorePublicAcls: true
+        RestrictPublicBuckets: true
       Tags:
         - Key: Solution
           Value: ACFS3
@@ -31,6 +36,11 @@
         ServerSideEncryptionConfiguration:
           - ServerSideEncryptionByDefault:
               SSEAlgorithm: AES256
+      PublicAccessBlockConfiguration:
+        BlockPublicAcls: true
+        BlockPublicPolicy: true
+        IgnorePublicAcls: true
+        RestrictPublicBuckets: true
       LoggingConfiguration:
         DestinationBucketName: !Ref 'S3BucketLogs'
         LogFilePrefix: 'origin/'
